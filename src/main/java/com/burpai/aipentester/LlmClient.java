package com.burpai.aipentester;

import java.util.List;
import java.util.Map;

/**
 * Common interface for LLM backend clients (Ollama, Gemini, etc.).
 */
public interface LlmClient {

  /** Tests connectivity and model availability. */
  ConnResult testConnection();

  /**
   * Sends a chat turn with optional tool definitions.
   *
   * @param messages OpenAI-style message list (role/content, tool messages).
   * @param tools    OpenAI-style function/tool schema list.
   */
  ChatResult chat(List<Map<String, Object>> messages, List<Map<String, Object>> tools);

  // ---- Value types shared by all implementations ----

  final class ConnResult {
    public final boolean ok;
    public final String message;

    public ConnResult(boolean ok, String message) {
      this.ok = ok;
      this.message = message;
    }
  }

  final class ToolCall {
    public final String name;
    public final Map<String, Object> args;

    public ToolCall(String name, Map<String, Object> args) {
      this.name = name;
      this.args = args;
    }
  }

  final class ChatResult {
    public final boolean ok;
    public final String content;
    public final List<ToolCall> toolCalls;
    public final String error;

    private ChatResult(boolean ok, String content, List<ToolCall> toolCalls, String error) {
      this.ok = ok;
      this.content = content;
      this.toolCalls = toolCalls;
      this.error = error;
    }

    public static ChatResult ok(String content, List<ToolCall> toolCalls) {
      return new ChatResult(true, content, toolCalls, null);
    }

    public static ChatResult err(String error) {
      return new ChatResult(false, null, null, error);
    }
  }
}
