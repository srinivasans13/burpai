package com.burpai.aipentester.model;

import java.util.Set;
import java.util.concurrent.ConcurrentHashMap;

/**
 * Represents a single endpoint in the {@link AttackGraph}.
 *
 * <p>All mutable {@code Set} fields use {@link ConcurrentHashMap#newKeySet()} for
 * thread-safe, lock-free concurrent access.
 */
public class EndpointNode {

  public final String path;
  public final Set<String> methods            = ConcurrentHashMap.newKeySet();
  public final Set<String> parameters         = ConcurrentHashMap.newKeySet();
  public final Set<String> testedPayloadTypes = ConcurrentHashMap.newKeySet();
  public final Set<String> extractedVariables = ConcurrentHashMap.newKeySet();

  /** {@code null} means unknown; non-null means explicitly set. */
  public volatile Boolean authRequired;

  public volatile long lastSeenTimestamp;

  public EndpointNode(String path) {
    this.path = path;
    this.lastSeenTimestamp = System.currentTimeMillis();
  }

  /** Bumps the {@link #lastSeenTimestamp} to the current time. */
  public void touch() {
    this.lastSeenTimestamp = System.currentTimeMillis();
  }

  /**
   * Returns {@code true} if this endpoint has not yet been tested for the given
   * vulnerability class.
   */
  public boolean hasUntestedPayload(String vulnClass) {
    return !testedPayloadTypes.contains(vulnClass);
  }

  /** Returns {@code true} if at least one parameter has been discovered. */
  public boolean hasParameters() {
    return !parameters.isEmpty();
  }
}
