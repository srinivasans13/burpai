package com.burpai.aipentester;

import burp.api.montoya.BurpExtension;
import burp.api.montoya.MontoyaApi;
import com.burpai.aipentester.ui.AgentTab;
import com.burpai.aipentester.ui.RepeaterCopilotEditor;

public class Extension implements BurpExtension {

  @Override
  public void initialize(MontoyaApi api) {
    api.logging().logToOutput("AI Pentest Agent starting up... Version: " + System.currentTimeMillis());
    api.extension().setName("AI Pentest Agent (Montoya + Ollama)");

    // ── Agentic pentester suite tab ──
    AgentTab tab = new AgentTab(api);
    api.userInterface().registerSuiteTab("AI Pentester", tab.ui());
    api.userInterface().registerContextMenuItemsProvider(tab);

    // ── Repeater Copilot: embedded tab inside each Repeater tab's request editor ──
    // Montoya creates one RepeaterCopilotEditor instance per Repeater tab.
    // The "AI Copilot" tab appears alongside Raw / Pretty / Hex inside Repeater.
    api.userInterface().registerHttpRequestEditorProvider(
        ctx -> new RepeaterCopilotEditor(api, ctx)
    );

    api.logging().logToOutput("Repeater Copilot editor tab registered.");
  }
}
